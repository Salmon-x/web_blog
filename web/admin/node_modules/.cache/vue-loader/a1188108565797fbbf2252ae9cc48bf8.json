{"remainingRequest":"/Users/salmon/go/src/我的博客/blog/web/admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/salmon/go/src/我的博客/blog/web/admin/src/components/user/UserList.vue?vue&type=style&index=0&id=3366b2e6&scoped=true&lang=css&","dependencies":[{"path":"/Users/salmon/go/src/我的博客/blog/web/admin/src/components/user/UserList.vue","mtime":1626250240672},{"path":"/Users/salmon/go/src/我的博客/blog/web/admin/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/salmon/go/src/我的博客/blog/web/admin/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/salmon/go/src/我的博客/blog/web/admin/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/salmon/go/src/我的博客/blog/web/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/salmon/go/src/我的博客/blog/web/admin/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCi5hY3Rpb25TbG90IHsKICBkaXNwbGF5OiBmbGV4OwogIGp1c3RpZnktY29udGVudDogY2VudGVyOwp9Cg=="},{"version":3,"sources":["UserList.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8dA;AACA;AACA;AACA","file":"UserList.vue","sourceRoot":"src/components/user","sourcesContent":["<template>\n  <div>\n    <a-card>\n      <a-row :gutter=\"20\">\n        <a-col :span=\"6\">\n          <a-input-search\n            v-model=\"queryParam.username\"\n            placeholder=\"输入用户名查找\"\n            enter-button\n            allowClear\n            @search=\"searchUser\"\n          />\n        </a-col>\n        <a-col :span=\"4\">\n          <a-button type=\"primary\" @click=\"addUserVisible = true\">新增</a-button>\n        </a-col>\n      </a-row>\n\n      <a-table\n        rowKey=\"ID\"\n        :columns=\"columns\"\n        :pagination=\"pagination\"\n        :dataSource=\"userlist\"\n        bordered\n        @change=\"handleTableChange\"\n      >\n        <span slot=\"role\" slot-scope=\"data\">{{ data == 1 ? '管理员' : '订阅者' }}</span>\n        <template slot=\"action\" slot-scope=\"data\">\n          <div class=\"actionSlot\">\n            <a-button\n              type=\"primary\"\n              icon=\"edit\"\n              style=\"margin-right: 15px\"\n              @click=\"editUser(data.ID)\"\n            >编辑</a-button>\n            <a-button\n              type=\"danger\"\n              icon=\"delete\"\n              style=\"margin-right: 15px\"\n              @click=\"deleteUser(data.ID)\"\n            >删除</a-button>\n            <a-button type=\"info\" icon=\"info\" @click=\"ChangePassword(data.ID)\">修改密码</a-button>\n          </div>\n        </template>\n      </a-table>\n    </a-card>\n\n    <!-- 新增用户区域 -->\n    <a-modal\n      closable\n      title=\"新增用户\"\n      :visible=\"addUserVisible\"\n      width=\"60%\"\n      @ok=\"addUserOk\"\n      @cancel=\"addUserCancel\"\n      destroyOnClose\n    >\n      <a-form-model :model=\"newUser\" :rules=\"addUserRules\" ref=\"addUserRef\">\n        <a-form-model-item label=\"用户名\" prop=\"username\">\n          <a-input v-model=\"newUser.username\"></a-input>\n        </a-form-model-item>\n        <a-form-model-item has-feedback label=\"密码\" prop=\"password\">\n          <a-input-password v-model=\"newUser.password\"></a-input-password>\n        </a-form-model-item>\n        <a-form-model-item has-feedback label=\"确认密码\" prop=\"checkpass\">\n          <a-input-password v-model=\"newUser.checkpass\"></a-input-password>\n        </a-form-model-item>\n      </a-form-model>\n    </a-modal>\n\n    <!-- 编辑用户区域 -->\n    <a-modal\n      closable\n      destroyOnClose\n      title=\"编辑用户\"\n      :visible=\"editUserVisible\"\n      width=\"60%\"\n      @ok=\"editUserOk\"\n      @cancel=\"editUserCancel\"\n    >\n      <a-form-model :model=\"userInfo\" :rules=\"userRules\" ref=\"addUserRef\">\n        <a-form-model-item label=\"用户名\" prop=\"username\">\n          <a-input v-model=\"userInfo.username\"></a-input>\n        </a-form-model-item>\n        <a-form-model-item label=\"是否为管理员\">\n          <a-switch\n            :checked=\"IsAdmin\"\n            checked-children=\"是\"\n            un-checked-children=\"否\"\n            @change=\"adminChange\"\n          />\n        </a-form-model-item>\n      </a-form-model>\n    </a-modal>\n\n    <!-- 修改密码 -->\n    <a-modal\n      closable\n      title=\"修改密码\"\n      :visible=\"changePasswordVisible\"\n      width=\"60%\"\n      @ok=\"changePasswordOk\"\n      @cancel=\"changePasswordCancel\"\n      destroyOnClose\n    >\n      <a-form-model :model=\"changePassword\" :rules=\"changePasswordRules\" ref=\"changePasswordRef\">\n        <a-form-model-item has-feedback label=\"密码\" prop=\"password\">\n          <a-input-password v-model=\"changePassword.password\"></a-input-password>\n        </a-form-model-item>\n        <a-form-model-item has-feedback label=\"确认密码\" prop=\"checkpass\">\n          <a-input-password v-model=\"changePassword.checkpass\"></a-input-password>\n        </a-form-model-item>\n      </a-form-model>\n    </a-modal>\n  </div>\n</template>\n\n<script>\nconst columns = [\n  {\n    title: 'ID',\n    dataIndex: 'ID',\n    width: '10%',\n    key: 'id',\n    align: 'center',\n  },\n  {\n    title: '用户名',\n    dataIndex: 'username',\n    width: '20%',\n    key: 'username',\n    align: 'center',\n  },\n  {\n    title: '角色',\n    dataIndex: 'role',\n    width: '20%',\n    key: 'role',\n    align: 'center',\n    scopedSlots: { customRender: 'role' },\n  },\n  {\n    title: '操作',\n    width: '30%',\n    key: 'action',\n    align: 'center',\n    scopedSlots: { customRender: 'action' },\n  },\n]\n\nexport default {\n  data() {\n    return {\n      pagination: {\n        pageSizeOptions: ['5', '10', '20'],\n        pageSize: 5,\n        total: 0,\n        showSizeChanger: true,\n        showTotal: (total) => `共${total}条`,\n      },\n      userlist: [],\n      userInfo: {\n        username: '',\n        password: '',\n        role: 2,\n        checkPass: '',\n      },\n      newUser: {\n        username: '',\n        password: '',\n        role: 2,\n        checkPass: '',\n      },\n      changePassword: {\n        id: 0,\n        password: '',\n        checkPass: '',\n      },\n      columns,\n      queryParam: {\n        username: '',\n        pagesize: 5,\n        pagenum: 1,\n      },\n      editVisible: false,\n      userRules: {\n        username: [\n          {\n            validator: (rule, value, callback) => {\n              if (this.userInfo.username == '') {\n                callback(new Error('请输入用户名'))\n              }\n              if ([...this.userInfo.username].length < 4 || [...this.userInfo.username].length > 12) {\n                callback(new Error('用户名应当在4到12个字符之间'))\n              } else {\n                callback()\n              }\n            },\n            trigger: 'blur',\n          },\n        ],\n        password: [\n          {\n            validator: (rule, value, callback) => {\n              if (this.userInfo.password == '') {\n                callback(new Error('请输入密码'))\n              }\n              if ([...this.userInfo.password].length < 6 || [...this.userInfo.password].length > 20) {\n                callback(new Error('密码应当在6到20位之间'))\n              } else {\n                callback()\n              }\n            },\n            trigger: 'blur',\n          },\n        ],\n        checkpass: [\n          {\n            validator: (rule, value, callback) => {\n              if (this.userInfo.checkpass == '') {\n                callback(new Error('请输入密码'))\n              }\n              if (this.userInfo.password !== this.userInfo.checkpass) {\n                callback(new Error('密码不一致，请重新输入'))\n              } else {\n                callback()\n              }\n            },\n            trigger: 'blur',\n          },\n        ],\n      },\n      addUserRules: {\n        username: [\n          {\n            validator: (rule, value, callback) => {\n              if (this.newUser.username == '') {\n                callback(new Error('请输入用户名'))\n              }\n              if ([...this.newUser.username].length < 4 || [...this.newUser.username].length > 12) {\n                callback(new Error('用户名应当在4到12个字符之间'))\n              } else {\n                callback()\n              }\n            },\n            trigger: 'blur',\n          },\n        ],\n        password: [\n          {\n            validator: (rule, value, callback) => {\n              if (this.newUser.password == '') {\n                callback(new Error('请输入密码'))\n              }\n              if ([...this.newUser.password].length < 6 || [...this.newUser.password].length > 20) {\n                callback(new Error('密码应当在6到20位之间'))\n              } else {\n                callback()\n              }\n            },\n            trigger: 'blur',\n          },\n        ],\n        checkpass: [\n          {\n            validator: (rule, value, callback) => {\n              if (this.newUser.checkpass == '') {\n                callback(new Error('请输入密码'))\n              }\n              if (this.newUser.password !== this.newUser.checkpass) {\n                callback(new Error('密码不一致，请重新输入'))\n              } else {\n                callback()\n              }\n            },\n            trigger: 'blur',\n          },\n        ],\n      },\n      changePasswordRules: {\n        password: [\n          {\n            validator: (rule, value, callback) => {\n              if (this.changePassword.password == '') {\n                callback(new Error('请输入密码'))\n              }\n              if ([...this.changePassword.password].length < 6 || [...this.changePassword.password].length > 20) {\n                callback(new Error('密码应当在6到20位之间'))\n              } else {\n                callback()\n              }\n            },\n            trigger: 'blur',\n          },\n        ],\n        checkpass: [\n          {\n            validator: (rule, value, callback) => {\n              if (this.changePassword.checkpass == '') {\n                callback(new Error('请输入密码'))\n              }\n              if (this.changePassword.password !== this.changePassword.checkpass) {\n                callback(new Error('密码不一致，请重新输入'))\n              } else {\n                callback()\n              }\n            },\n            trigger: 'blur',\n          },\n        ],\n      },\n      editUserVisible: false,\n      addUserVisible: false,\n      changePasswordVisible: false,\n    }\n  },\n  created() {\n    this.getUserList()\n  },\n  computed: {\n    IsAdmin: function () {\n      if (this.userInfo.role === 1) {\n        return true\n      } else {\n        return false\n      }\n    },\n  },\n  methods: {\n    // 获取用户列表\n    async getUserList() {\n      const { data: res } = await this.$http.get('/api/v1/user/', {\n        params: {\n          username: this.queryParam.username,\n          page: this.queryParam.pagesize,\n          size: this.queryParam.pagenum,\n        },\n      })\n      if (res.status !== 200) {\n        if (res.status === 1004 || 1005 || 1006 || 1007) {\n          window.sessionStorage.clear()\n          this.$router.push('/login')\n        }\n        this.$message.error(res.message)\n      }\n      this.userlist = res.data\n      this.pagination.total = res.total\n    },\n\n    // 搜索用户\n    async searchUser() {\n      this.queryParam.pagenum = 1\n      this.pagination.current = 1\n      const { data: res } = await this.$http.get('admin/users', {\n        params: {\n          username: this.queryParam.username,\n          pagesize: this.queryParam.pagesize,\n          pagenum: this.queryParam.pagenum,\n        },\n      })\n      if (res.status !== 200) return this.$message.error(res.message)\n      this.userlist = res.data\n      this.pagination.total = res.total\n    },\n\n    // 更改分页\n    handleTableChange(pagination, filters, sorter) {\n      var pager = { ...this.pagination }\n      pager.current = pagination.current\n      pager.pageSize = pagination.pageSize\n      this.queryParam.pagesize = pagination.pageSize\n      this.queryParam.pagenum = pagination.current\n\n      if (pagination.pageSize !== this.pagination.pageSize) {\n        this.queryParam.pagenum = 1\n        pager.current = 1\n      }\n      this.pagination = pager\n      this.getUserList()\n    },\n    // 删除用户\n    deleteUser(id) {\n      this.$confirm({\n        title: '提示：请再次确认',\n        content: '确定要删除该用户吗？一旦删除，无法恢复',\n        onOk: async () => {\n          const { data: res } = await this.$http.delete(`user/${id}`)\n          if (res.status != 200) return this.$message.error(res.message)\n          this.$message.success('删除成功')\n          this.getUserList()\n        },\n        onCancel: () => {\n          this.$message.info('已取消删除')\n        },\n      })\n    },\n    // 新增用户\n    addUserOk() {\n      this.$refs.addUserRef.validate(async (valid) => {\n        if (!valid) return this.$message.error('参数不符合要求，请重新输入')\n        const { data: res } = await this.$http.post('user/add', {\n          username: this.newUser.username,\n          password: this.newUser.password,\n          role: this.newUser.role,\n        })\n        if (res.status != 200) return this.$message.error(res.message)\n        this.$refs.addUserRef.resetFields()\n        this.addUserVisible = false\n        this.$message.success('添加用户成功')\n        this.getUserList()\n      })\n    },\n    addUserCancel() {\n      this.$refs.addUserRef.resetFields()\n      this.addUserVisible = false\n      this.$message.info('新增用户已取消')\n    },\n    adminChange(checked) {\n      if (checked) {\n        this.userInfo.role = 1\n      } else {\n        this.userInfo.role = 2\n      }\n    },\n    // 编辑用户\n    async editUser(id) {\n      this.editUserVisible = true\n      const { data: res } = await this.$http.get(`user/${id}`)\n      this.userInfo = res.data\n      this.userInfo.id = id\n    },\n    editUserOk() {\n      this.$refs.addUserRef.validate(async (valid) => {\n        if (!valid) return this.$message.error('参数不符合要求，请重新输入')\n        const { data: res } = await this.$http.put(`user/${this.userInfo.id}`, {\n          username: this.userInfo.username,\n          role: this.userInfo.role,\n        })\n        if (res.status != 200) return this.$message.error(res.message)\n        this.editUserVisible = false\n        this.$message.success('更新用户信息成功')\n        this.getUserList()\n      })\n    },\n    editUserCancel() {\n      this.$refs.addUserRef.resetFields()\n      this.editUserVisible = false\n      this.$message.info('编辑已取消')\n    },\n\n    // 修改密码\n    async ChangePassword(id) {\n      this.changePasswordVisible = true\n      const { data: res } = await this.$http.get(`user/${id}`)\n      this.changePassword.id = id\n    },\n    changePasswordOk() {\n      this.$refs.changePasswordRef.validate(async (valid) => {\n        if (!valid) return this.$message.error('参数不符合要求，请重新输入')\n        const { data: res } = await this.$http.put(`admin/changepw/${this.changePassword.id}`, {\n          password: this.changePassword.password,\n        })\n        if (res.status != 200) return this.$message.error(res.message)\n        this.changePasswordVisible = false\n        this.$message.success('修改密码成功')\n        this.getUserList()\n      })\n    },\n    changePasswordCancel() {\n      this.$refs.changePasswordRef.resetFields()\n      this.changePasswordVisible = false\n      this.$message.info('已取消')\n    },\n  },\n}\n</script>\n\n<style scoped>\n.actionSlot {\n  display: flex;\n  justify-content: center;\n}\n</style>"]}]}